<html><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,intitial-scale=1,maximum-scale=1">
    <script type="text/javascript" src="JS/jquery-1.12.2.min.js"></script>
    <script type="text/javascript" src="JS/picker.js"></script>
    <script type="text/javascript" src="JS/picker.date.js"></script>
    <script type="text/javascript" src="JS/fdb-all.min.js"></script>
    <script type="text/javascript" src="JS/bootstrap.min.js"></script>
    <link href="CSS/bootstrap.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="CSS/main.css">
    <link rel="stylesheet" href="CSS/default.css">
    <link rel="stylesheet" href="CSS/default.date.css">
  </head>
  <body>
    <div class="non-semantic-protector"> 
      <h1 class="ribbon">
        <strong class="ribbon-content">支出查詢</strong>
      </h1>
    </div>
    <input type="radio" name="month" value="thismonth" style="margin-left: 30%;">
    本月份
    
    <input type="radio" name="month" value="months" style="margin-left:5%">
    指定月份
    <br>
    <input type="text" style="margin-left:18%;width:30%" id="start" class="datepicker picker__input" readonly="" aria-haspopup="true" aria-expanded="false" aria-readonly="false" aria-owns="start_root"><div class="picker" id="start_root" aria-hidden="true"><div class="picker__holder" tabindex="-1"><div class="picker__frame"><div class="picker__wrap"><div class="picker__box"><div class="picker__header"><div class="picker__month">September</div><div class="picker__year">2016</div><div class="picker__nav--prev" data-nav="-1" role="button" aria-controls="start_table" title="Previous month"> </div><div class="picker__nav--next" data-nav="1" role="button" aria-controls="start_table" title="Next month"> </div></div><table class="picker__table" id="start_table" role="grid" aria-controls="start" aria-readonly="true"><thead><tr><th class="picker__weekday" scope="col" title="Sunday">Sun</th><th class="picker__weekday" scope="col" title="Monday">Mon</th><th class="picker__weekday" scope="col" title="Tuesday">Tue</th><th class="picker__weekday" scope="col" title="Wednesday">Wed</th><th class="picker__weekday" scope="col" title="Thursday">Thu</th><th class="picker__weekday" scope="col" title="Friday">Fri</th><th class="picker__weekday" scope="col" title="Saturday">Sat</th></tr></thead><tbody><tr><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1472313600000" role="gridcell" aria-label="2016-08-28">28</div></td><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1472400000000" role="gridcell" aria-label="2016-08-29">29</div></td><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1472486400000" role="gridcell" aria-label="2016-08-30">30</div></td><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1472572800000" role="gridcell" aria-label="2016-08-31">31</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1472659200000" role="gridcell" aria-label="2016-09-01">1</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1472745600000" role="gridcell" aria-label="2016-09-02">2</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1472832000000" role="gridcell" aria-label="2016-09-03">3</div></td></tr><tr><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1472918400000" role="gridcell" aria-label="2016-09-04">4</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1473004800000" role="gridcell" aria-label="2016-09-05">5</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1473091200000" role="gridcell" aria-label="2016-09-06">6</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1473177600000" role="gridcell" aria-label="2016-09-07">7</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1473264000000" role="gridcell" aria-label="2016-09-08">8</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1473350400000" role="gridcell" aria-label="2016-09-09">9</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1473436800000" role="gridcell" aria-label="2016-09-10">10</div></td></tr><tr><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1473523200000" role="gridcell" aria-label="2016-09-11">11</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1473609600000" role="gridcell" aria-label="2016-09-12">12</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1473696000000" role="gridcell" aria-label="2016-09-13">13</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1473782400000" role="gridcell" aria-label="2016-09-14">14</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1473868800000" role="gridcell" aria-label="2016-09-15">15</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1473955200000" role="gridcell" aria-label="2016-09-16">16</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1474041600000" role="gridcell" aria-label="2016-09-17">17</div></td></tr><tr><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1474128000000" role="gridcell" aria-label="2016-09-18">18</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1474214400000" role="gridcell" aria-label="2016-09-19">19</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1474300800000" role="gridcell" aria-label="2016-09-20">20</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1474387200000" role="gridcell" aria-label="2016-09-21">21</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1474473600000" role="gridcell" aria-label="2016-09-22">22</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1474560000000" role="gridcell" aria-label="2016-09-23">23</div></td><td role="presentation"><div class="picker__day picker__day--infocus picker__day--today picker__day--highlighted" data-pick="1474646400000" role="gridcell" aria-label="2016-09-24" aria-activedescendant="true">24</div></td></tr><tr><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1474732800000" role="gridcell" aria-label="2016-09-25">25</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1474819200000" role="gridcell" aria-label="2016-09-26">26</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1474905600000" role="gridcell" aria-label="2016-09-27">27</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1474992000000" role="gridcell" aria-label="2016-09-28">28</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1475078400000" role="gridcell" aria-label="2016-09-29">29</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1475164800000" role="gridcell" aria-label="2016-09-30">30</div></td><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1475251200000" role="gridcell" aria-label="2016-10-01">1</div></td></tr><tr><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1475337600000" role="gridcell" aria-label="2016-10-02">2</div></td><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1475424000000" role="gridcell" aria-label="2016-10-03">3</div></td><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1475510400000" role="gridcell" aria-label="2016-10-04">4</div></td><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1475596800000" role="gridcell" aria-label="2016-10-05">5</div></td><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1475683200000" role="gridcell" aria-label="2016-10-06">6</div></td><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1475769600000" role="gridcell" aria-label="2016-10-07">7</div></td><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1475856000000" role="gridcell" aria-label="2016-10-08">8</div></td></tr></tbody></table><div class="picker__footer"><button class="picker__button--today" type="button" data-pick="1474646400000" disabled="" aria-controls="start">Today</button><button class="picker__button--clear" type="button" data-clear="1" disabled="" aria-controls="start">Clear</button><button class="picker__button--close" type="button" data-close="true" disabled="" aria-controls="start">Close</button></div></div></div></div></div></div>
    ~
    <input type="text" style="width:30%" id="end" class="datepicker picker__input" readonly="" aria-haspopup="true" aria-expanded="false" aria-readonly="false" aria-owns="end_root"><div class="picker" id="end_root" aria-hidden="true"><div class="picker__holder" tabindex="-1"><div class="picker__frame"><div class="picker__wrap"><div class="picker__box"><div class="picker__header"><div class="picker__month">September</div><div class="picker__year">2016</div><div class="picker__nav--prev" data-nav="-1" role="button" aria-controls="end_table" title="Previous month"> </div><div class="picker__nav--next" data-nav="1" role="button" aria-controls="end_table" title="Next month"> </div></div><table class="picker__table" id="end_table" role="grid" aria-controls="end" aria-readonly="true"><thead><tr><th class="picker__weekday" scope="col" title="Sunday">Sun</th><th class="picker__weekday" scope="col" title="Monday">Mon</th><th class="picker__weekday" scope="col" title="Tuesday">Tue</th><th class="picker__weekday" scope="col" title="Wednesday">Wed</th><th class="picker__weekday" scope="col" title="Thursday">Thu</th><th class="picker__weekday" scope="col" title="Friday">Fri</th><th class="picker__weekday" scope="col" title="Saturday">Sat</th></tr></thead><tbody><tr><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1472313600000" role="gridcell" aria-label="2016-08-28">28</div></td><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1472400000000" role="gridcell" aria-label="2016-08-29">29</div></td><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1472486400000" role="gridcell" aria-label="2016-08-30">30</div></td><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1472572800000" role="gridcell" aria-label="2016-08-31">31</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1472659200000" role="gridcell" aria-label="2016-09-01">1</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1472745600000" role="gridcell" aria-label="2016-09-02">2</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1472832000000" role="gridcell" aria-label="2016-09-03">3</div></td></tr><tr><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1472918400000" role="gridcell" aria-label="2016-09-04">4</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1473004800000" role="gridcell" aria-label="2016-09-05">5</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1473091200000" role="gridcell" aria-label="2016-09-06">6</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1473177600000" role="gridcell" aria-label="2016-09-07">7</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1473264000000" role="gridcell" aria-label="2016-09-08">8</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1473350400000" role="gridcell" aria-label="2016-09-09">9</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1473436800000" role="gridcell" aria-label="2016-09-10">10</div></td></tr><tr><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1473523200000" role="gridcell" aria-label="2016-09-11">11</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1473609600000" role="gridcell" aria-label="2016-09-12">12</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1473696000000" role="gridcell" aria-label="2016-09-13">13</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1473782400000" role="gridcell" aria-label="2016-09-14">14</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1473868800000" role="gridcell" aria-label="2016-09-15">15</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1473955200000" role="gridcell" aria-label="2016-09-16">16</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1474041600000" role="gridcell" aria-label="2016-09-17">17</div></td></tr><tr><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1474128000000" role="gridcell" aria-label="2016-09-18">18</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1474214400000" role="gridcell" aria-label="2016-09-19">19</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1474300800000" role="gridcell" aria-label="2016-09-20">20</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1474387200000" role="gridcell" aria-label="2016-09-21">21</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1474473600000" role="gridcell" aria-label="2016-09-22">22</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1474560000000" role="gridcell" aria-label="2016-09-23">23</div></td><td role="presentation"><div class="picker__day picker__day--infocus picker__day--today picker__day--highlighted" data-pick="1474646400000" role="gridcell" aria-label="2016-09-24" aria-activedescendant="true">24</div></td></tr><tr><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1474732800000" role="gridcell" aria-label="2016-09-25">25</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1474819200000" role="gridcell" aria-label="2016-09-26">26</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1474905600000" role="gridcell" aria-label="2016-09-27">27</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1474992000000" role="gridcell" aria-label="2016-09-28">28</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1475078400000" role="gridcell" aria-label="2016-09-29">29</div></td><td role="presentation"><div class="picker__day picker__day--infocus" data-pick="1475164800000" role="gridcell" aria-label="2016-09-30">30</div></td><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1475251200000" role="gridcell" aria-label="2016-10-01">1</div></td></tr><tr><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1475337600000" role="gridcell" aria-label="2016-10-02">2</div></td><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1475424000000" role="gridcell" aria-label="2016-10-03">3</div></td><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1475510400000" role="gridcell" aria-label="2016-10-04">4</div></td><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1475596800000" role="gridcell" aria-label="2016-10-05">5</div></td><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1475683200000" role="gridcell" aria-label="2016-10-06">6</div></td><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1475769600000" role="gridcell" aria-label="2016-10-07">7</div></td><td role="presentation"><div class="picker__day picker__day--outfocus" data-pick="1475856000000" role="gridcell" aria-label="2016-10-08">8</div></td></tr></tbody></table><div class="picker__footer"><button class="picker__button--today" type="button" data-pick="1474646400000" disabled="" aria-controls="end">Today</button><button class="picker__button--clear" type="button" data-clear="1" disabled="" aria-controls="end">Clear</button><button class="picker__button--close" type="button" data-close="true" disabled="" aria-controls="end">Close</button></div></div></div></div></div></div>
    <button id="check" class="btn btn-primary" style="width:70%;margin-left:15%;margin-top:3%">查詢</button>
    <table>
      <thead>
        <tr>
          <th>類別</th>
          <th>金額</th>
          <th>比例</th>
        </tr>
      </thead>
      <tbody id="type">
      </tbody>
    </table>
        <table>
      <thead>
        <tr>
          <th>日期</th>
          <th>事項</th>
          <th>金額</th>
        </tr>
      </thead>
      <tbody id="on">
      </tbody>
    </table>
    <a href="index.html"><button class="btn btn-success" style="margin-left:25%;width:50%;margin-bottom:10%">返回</button></a>
    <script>
      var fdb = new ForerunnerDB();
      var db = fdb.db("expenses");
      var expensesCollection = db.collection('expenses');
      var date = new Date();
      var year = date.getFullYear();
      var month = date.getMonth()+1;
      var date = date.getDate();
      var select = "";
      var result = "";
      var startDate = "";
      var endDate = "";
      var sum = 0;
      var type = {};
      var thistype = "";
      if(month<10){
        month = "0"+month;
      }
      if(date<10){
        date = "0"+date;
      }
      console.log(year+"-"+month+"-01");
      expensesCollection.load(function(){
        $('.datepicker').pickadate({format:"yyyy-mm-dd"});
        $("#check").click(function(){
            function showData(){
                type={
                    食:0,
                    衣:0,
                    住:0,
                    行:0,
                    育:0,
                    樂:0,
                  };
                for(var i=0;i<result.length;i++){
                    thistype=result[i].type;
                    type[thistype] += result[i].money/1
                };
                sum = type.食+type.衣+type.住+type.行+type.育+type.樂;
                $("#type *").remove();
                $("#type").append("<tr><td>食</td><td>"+type.食+"</td><td>"+Math.floor(type.食*100/sum)+"%</td></tr>");
                $("#type").append("<tr><td>衣</td><td>"+type.衣+"</td><td>"+Math.floor(type.衣*100/sum)+"%</td></tr>");
                $("#type").append("<tr><td>住</td><td>"+type.住+"</td><td>"+Math.floor(type.住*100/sum)+"%</td></tr>");
                $("#type").append("<tr><td>行</td><td>"+type.行+"</td><td>"+Math.floor(type.行*100/sum)+"%</td></tr>");
                $("#type").append("<tr><td>育</td><td>"+type.育+"</td><td>"+Math.floor(type.育*100/sum)+"%</td></tr>");
                $("#type").append("<tr><td>樂</td><td>"+type.樂+"</td><td>"+Math.floor(type.樂*100/sum)+"%</td></tr>");
                $("#on *").remove();
                for(var i=0;i<result.length;i++){
                    $("#on").append(
                        "<tr><td>"+result[i].time+
                        "</td><td>"+result[i].thing+
                        "</td><td>"+result[i].money+
                        "</td></tr>"
                    );
                };
            };
            select = $("input[name=month]:checked").val();
            console.log(select);
            startDate = $("#start").val();
            endDate = $("#end").val();
            if(!(select=="thismonth"||select=="months")){
                alert("You didn't select the month!");
            };
            if(select == "months" && !(startDate=="") && !(endDate=="")){
                result = expensesCollection.find({
                    time:{
                        $gte: startDate,
                        $lte: endDate
                    }},
                    {$orderBy:{time:-1}}
                );
                console.log(startDate+" , "+endDate);
                console.log(result);
                showData();
            }else if(select == "thismonth"){
                result = expensesCollection.find({
                    time:{
                    $gte: year+"-"+month+"-01",
                    $lte: year+"-"+month+"-"+date
                  }},
                  {$orderBy:{time:-1}}
                );
                console.log(result);
                showData();
            };
        });
      });
    </script>
    </body>
</html>
